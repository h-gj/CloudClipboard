{% extends 'base.html' %}
{#{% block title_suffix %}New{% endblock %}#}
{% block body_content %}
    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="autoCommitSwitch" checked>
        <label class="form-check-label" for="flexSwitchCheckDefault">Auto commit</label>
    </div>


    <form method="post" id="contentForm">
        {% csrf_token %}


        <div class="mb-3">
            <label for="exampleFormControlInput1" class="form-label">Channel ID</label>
            <input required type="text" class="form-control" id="channel_id"
                   placeholder="" name="channel_id">
        </div>
        <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label">Content</label>
            <textarea required class="form-control" id="content" name="content"
                      placeholder="" rows="5"></textarea>
        </div>

        {#        <div class="mb-3">#}
        {#            <button type="submit" class="btn btn-primary mb-3" id="submitContent">Submit</button>#}
        {#        </div>#}

    </form>

    <script>
        $(document).ready(
            $('#contentForm').on('submit', function (e) {
                window.localStorage.setItem('CID', $('#channel_id').val())
            })
        )

        $(document).ready(
            () => {
                const content = $('#content');
                const contentForm = $('#contentForm');

                contentForm.val()

                content.focus()

                const cid = window.localStorage.getItem('CID')
                const autoCommit = window.localStorage.getItem('autoCommit')
                if (cid) {
                    $('#channel_id').val(cid);
                }
                if (autoCommit === 'off') {
                    $('#autoCommitSwitch').attr('checked', false)
                }

                contentForm.keypress(function (e) {
                    var code = (e.keyCode ? e.keyCode : e.which); // grabs keycode pressed
                    if (code === 13) {  // Code 13 is enter
                        e.preventDefault();
                        contentForm.submit()
                    }
                });

                content.on('input', function () {
                    const autoCommit = window.localStorage.getItem('autoCommit') || 'on'
                    if (autoCommit === 'on') {
                        contentForm.submit()
                    }
                })


                $('#autoCommitSwitch').on('change', function () {
                    const currentState = window.localStorage.getItem('autoCommit') || 'on';
                    console.log('currentState', currentState);
                    window.localStorage.setItem('autoCommit', currentState === 'on' ? 'off' : 'on');
                })
            }
        )
    </script>
{% endblock %}